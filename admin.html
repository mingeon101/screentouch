<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Screentouch 관리자 페이지</title>

    <style>
        body {
            font-family: "Segoe UI", sans-serif;
            background: #f5f6fa;
            padding: 30px;
        }

        h1 { text-align: center; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 30px;
        }

        th, td {
            border: 1px solid #ccc;
            padding: 12px;
            text-align: left;
        }

        th { background-color: #0984e3; color: white; }

        tr:nth-child(even) { background-color: #dfe6e9; }

        input[type="text"], textarea {
            width: 100%;
            padding: 8px;
            margin-top: 4px;
            border-radius: 8px;
            border: 1px solid #ccc;
            box-sizing: border-box;
        }

        button {
            padding: 8px 16px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            margin-top: 4px;
            background-color: #0984e3;
            color: white;
        }

        button.delete { background-color: #d63031; }

    </style>
</head>
<body>

<h1>Screentouch 관리자 페이지</h1>

<p>아래에서 사용자가 올린 질문을 확인하고 답변을 작성할 수 있습니다.</p>

<table id="questionsTable">
    <thead>
        <tr>
            <th>아이디</th>
            <th>질문</th>
            <th>답변</th>
            <th>수정/삭제</th>
        </tr>
    </thead>
    <tbody>
        <!-- 질문 목록이 여기 채워짐 -->
    </tbody>
</table>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getDatabase, ref, get, update, remove } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyD5LF-_E3X4Ix4JDiBJFIqzoa0aKk6qoQ4",
        authDomain: "screentouch-d9ad3.firebaseapp.com",
        databaseURL: "https://screentouch-d9ad3-default-rtdb.firebaseio.com/",
        projectId: "screentouch-d9ad3",
        storageBucket: "screentouch-d9ad3.firebasestorage.app",
        messagingSenderId: "576628623458",
        appId: "1:576628623458:web:c54a8e03de793a866ba93b",
        measurementId: "G-5TS2P0EQVE"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const tableBody = document.querySelector("#questionsTable tbody");

    async function loadQuestions() {
        tableBody.innerHTML = "";
        const snapshot = await get(ref(db, "questions/"));
        if (!snapshot.exists()) return;

        const questions = snapshot.val();

        for (const id in questions) {
            const q = questions[id];
            const row = document.createElement("tr");

            row.innerHTML = `
                <td>${id}</td>
                <td><textarea readonly>${q.question}</textarea></td>
                <td><textarea id="answer-${id}">${q.answer}</textarea></td>
                <td>
                    <button onclick="saveAnswer('${id}')">답변 저장</button>
                    <button class="delete" onclick="deleteQuestion('${id}')">삭제</button>
                </td>
            `;
            tableBody.appendChild(row);
        }
    }

    window.saveAnswer = async function(id) {
        const answerText = document.getElementById(`answer-${id}`).value.trim();
        if (!answerText) { alert("답변을 입력하세요."); return; }
        await update(ref(db, "questions/" + id), { answer: answerText });
        alert("답변이 저장되었습니다.");
    }

    window.deleteQuestion = async function(id) {
        if (!confirm("정말 삭제하시겠습니까?")) return;
        await remove(ref(db, "questions/" + id));
        alert("질문이 삭제되었습니다.");
        loadQuestions();
    }

    loadQuestions();
</script>

</body>
</html>
